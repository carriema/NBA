<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="//d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
</head>
<body>



</body>
<script>

    var margin = {left:30, right : 30, top:180, bottom: 100};
    var width = 900 + margin.left + margin.right,
            height = 600 + margin.top + margin.bottom;


    //Define map projection
    var projection = d3.geo.albersUsa()
            .translate([width/3, height/3.5])
            .scale([900]);


    //Define path generator
    var path = d3.geo.path()
            .projection(projection);

    //Map the winrate to opacity[0.3, 0.9]
    var Opacity = d3.scale.linear()
            .range([0.2, 0.9]);

    //Map the rank to radius[2, 20]
    var Scale = d3.scale.linear()
            .range([2, 20]);

    //Create SVG element
    var svg = d3.select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .on("click", stopped, true);

    //Creater a group to store states
    var g = svg.append("g")
            .attr("class","map");



    //Load in state data, draw the map
    d3.csv("US-states.csv", function(data) {
        //Load in GeoJSON data
        d3.json("US-geo.json", function(json) {
            //Merge the EastorWest data and GeoJSON
            //Loop through once for each EastorWest data value
            for (var i = 0; i < data.length; i++) {
                var dataState = data[i].state;				//Grab state name
                var dataValue = parseFloat(data[i].value);	//Grab data value, and convert from string to float
                var dataEASTorWEST = data[i].EASTorWEST;
                //Find the corresponding state inside the GeoJSON
                for (var j = 0; j < json.features.length; j++) {
                    var jsonState = json.features[j].properties.name;
                    if (dataState == jsonState) {
                        //Copy the data value into the JSON
                        json.features[j].properties.EASTorWEST = dataEASTorWEST;
                        //Stop looking through the JSON
                        break;
                    }
                }
            }

            //Bind data and create one path per GeoJSON feature
            g.selectAll("path")
                    .data(json.features).enter()
                    .append("path")
                    .attr("stroke","white")
                    .attr("stroke-width",2)
                    .attr("d", path)
                    .attr("class", function(d) {
                        return d.properties.postal;})
                    .style("fill", function(d) {
                        //Get data value
                        var EASTorWEST = d.properties.EASTorWEST;

                        if (EASTorWEST) {
                            //If value exists…
                            if (EASTorWEST == "East") {
                                return "#C6E2FF";
                            } else {
                                return "#FFB6C1";
                            }
                        } else {
                            //If value is undefined…
                            return "#CCCCCC";
                        }
                    });
//                    .on("click", stateClick);

            //Load in NBA teams data
            d3.csv("NBA-teams.csv", function(data) {
                //Map the rank to radius[2, 20]
                Scale.domain([0, d3.max(data, function(d) { return d.winrate; })]);

                //Map the rank to opacity[0.3, 0.9]
                Opacity.domain([0, d3.max(data, function(d) { return d.winrate; })]);


                //Create nodes group
                var nodes = g.selectAll("nodes")
                        .data(data)
                        .enter()
                        .append("g")
                        .attr("class", "team")
                        .attr("transform", function(d) {
                            return "translate(" + projection([d.lon, d.lat])[0] + "," + projection([d.lon, d.lat])[1] + ")";});



                //Circles for teams
                nodes.append("circle")
                        .attr("class", function(d) { return d.abb })
                        .attr("r", 8)
                        .style("fill", function(d){
                            if (d.EASTorWEST == "East") {
                                return "blue";
                            } else {
                                return "red";
                            };
                        })
                        .style("opacity", 0.8)
                        .attr("stroke","white")
                        .attr("stroke-width",0.5);
//                        .style("cursor", "pointer")

                //Text for temm abbreviation
                nodes.append("text")
                        .attr("class", function(d) {
                            return "text " + d.abb;})
                        .attr("dx", function(d){
                            return Scale(d.winrate);})
                        .attr("dy", ".3em")
                        .attr("font-size", 13)
                        .style("fill", "#888888")
                        .style("font-weight", "bold")
                        .style("cursor", "default")
                        .text(function(d) {
                            return d.abb;});
            });
        });
    });
    function stopped() {
        if (d3.event.defaultPrevented) {
            d3.event.stopPropagation();
        }
    }
</script>
</html>